#!/usr/bin/bash

set -e

RESULTSD="$1"
OPWD="$PWD"

cd $RESULTSD

find *.d/*.d/ -type d | sort -h | while read TESTDIR; do
  RELTESTDIR=$(realpath -s --relative-to="$OPWD" "$TESTDIR")

  # Preints <PASS|FAIL> <PATH>
  echo $(readlink $TESTDIR/result) $TESTDIR

  HAD_DETAILS=false
  for C in FAIL INFO WARN; do
    [[ -f $TESTDIR/$C ]] && { sed "s/^/     /" $TESTDIR/$C ; HAD_DETAILS=true ; } ;
  done

  $HAD_DETAILS && echo "     See '$RELTESTDIR/log.txt' for more details"
done | colorfy

